#!/bin/bash -xe
dnf install -y dnf-utils "https://resources.ovirt.org/pub/yum-repo/ovirt-release-master.rpm"

# TODO: Remove once release RPM enables these properly on el9stream
dnf config-manager --set-enabled crb
dnf config-manager --set-enabled resilientstorage

dnf config-manager --add-repo "https://resources.ovirt.org/repos/ovirt/tested/master/rpm/el9/"

dnf -y --nogpgcheck install \
    ovirt-host \
    python3-coverage
# We install NetworkManager-config-server by default with
# vdsm which stops automatic DHCP assignments to interfaces.
# We use that in OST deploy so let's just disable that
# and let DHCP do its job
rm "/usr/lib/NetworkManager/conf.d/00-server.conf"
